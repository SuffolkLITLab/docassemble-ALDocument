---
modules:
  - .al_document
---
objects:
  - template1: ALDocument.using(filename="template1", has_addendum=False)
  - template2: ALDocument.using(filename="template2", has_addendum=True)
  - hello_world: ALDocument.using(filename="hello", has_addendum=False)
---
objects:
  - court_bundle: ALDocumentBundle.using(elements=[template1,template2,hello_world], filename="court_bundle.pdf")
---
mandatory: True
code: |
  template1.enabled
  field1
  template2.overflow_fields.gathered
  preview
  download
---
code: |
  template2.need_addendum = True
---
question: |
  Enter some data
fields:
  - field1: field1
    datatype: area
  - field2: field2
    datatype: area
  - field3: field3
    datatype: area
---
code: |
  template2.overflow_fields.from_list([
    {'field_name':'field1', 
     'overflow_trigger': 20},
    {'field_name': 'field2',
     'overflow_trigger': 20},
    {'field_name': 'field3',
     'overflow_trigger': 20}
     ])
  template2.overflow_fields.gathered=True
---
continue button field: debug_overflow
question: |
  ${ template2.overflow_fields }
---
question: |
  Which documents do you want?
fields:
  - Template 1: template1.enabled
    datatype: yesno
  - Template 2: template2.enabled
    datatype: yesno
---
question: |
  How old are you?
fields:
  - no label: age
    datatype: integer
---
code: |
  hello_world.enabled = age > 10
---
question: |
  Sign below
signature: user_signature  
---
continue button field: preview
question: |
  Test
subquestion: |
  ${ court_bundle.preview() }
---
event: download
question: |
  Test
subquestion: |
  ${ court_bundle.as_pdf() }
  
  ${ court_bundle.as_pdf_list() }
  
attachment code: court_bundle.as_flat_list()
---
attachment:
  - variable name: template1[i]
    name: xyz
    filename: xyz
    content: |
      # Cover Page
      
      Some cover page info
---
attachment:
  - variable name: template2[i]
    content: |
      Example 2
      
      Field1: ${ template2.overflow_fields['field1'].safe_value() }
     
      Field2: ${ template2.overflow_fields['field2'].safe_value() }
      
      Field3: ${ template2.overflow_fields['field3'].safe_value() }
      
      % if i=='final':
      ${ user_signature }
      % endif
      
      This text is simulating triggering an overflow
---
attachment:
  - name: A *hello world* document
    filename: Hello_World_Document
    variable name: hello_world[i]
    content: |
      Hello, world!
      
      I only appear if you are older than 10
---
generic object: ALDocument
attachment:
  - variable name: x.addendum
    content: |
      # Addendum for ${ x.filename }
      
      % for field in x.overflow_fields.defined_fields():
      ${ field.field_name }: 
      
      > ${ field.overflow_value() }
      
      % endfor