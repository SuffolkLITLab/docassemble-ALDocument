---
modules:
  - .al_document
---
objects:
  - template1: ALDocument.using(title="Template 1", filename="template1", has_addendum=False)
  - template2: ALDocument.using(title="Template 2", filename="template2", has_addendum=True, default_overflow_message = " (see addendum)")
  - hello_world: ALDocument.using(title="Hello, World", filename="hello", has_addendum=False)
  - field4: DAList.using(there_are_any=True)
---
objects:
  - court_bundle: ALDocumentBundle.using(elements=[template1,template2,hello_world], filename="court_bundle.pdf", title="Forms to download and deliver to court")
---
mandatory: True
code: |
  template1.enabled
  if template2.enabled:
    field1
    field4.gather()
  preview
  download
---
code: |
  template2.need_addendum = True
---
question: |
  Enter some data
fields:
  - field1: field1
    datatype: area
  - field2: field2
    datatype: area
  - field3: field3
    datatype: area
---
question: |
  What are your favorite fruits?
subquestion: |
  Up to 2 will fit on the main form. The rest will go on an addendum.
list collect: True
fields:
  - Fruit name: field4[i]
---
code: |
  template2.overflow_fields['field1'].overflow_trigger = 10
  template2.overflow_fields['field2'].overflow_trigger = 20
  template2.overflow_fields['field3'].overflow_trigger = 5
  template2.overflow_fields['field4'].overflow_trigger = 2
  
  template2.overflow_fields.gathered=True
---
continue button field: debug_overflow
question: |
  ${ template2.overflow_fields }
---
question: |
  Which documents do you want?
fields:
  - Template 1: template1.enabled
    datatype: yesno
  - Template 2: template2.enabled
    datatype: yesno
---
question: |
  How old are you?
fields:
  - no label: age
    datatype: integer
---
code: |
  hello_world.enabled = age > 10
---
question: |
  Sign below
signature: user_signature  
---
continue button field: preview
question: |
  Look at the document below before you sign it
subquestion: |
  ${ court_bundle.preview() }
---
event: download
question: |
  Test
subquestion: |
  
  ${ court_bundle.download_buttons_html() }
  
  Or, download as one file:  
  ${ court_bundle.download_button_html() }
  
attachment code: court_bundle.as_flat_list()
---
attachment:
  - variable name: template1[i]
    name: xyz
    filename: xyz
    content: |
      # Cover Page
      
      Some cover page info
---
attachment:
  - variable name: template2[i]
    content: |
      # Example of handling overflow
      
      This document simulates a PDF with fixed field width.
      Any overflow that exceeds character limit for the fields
      below will go to an addendum.
     
      Field1: ${ template2.safe_value('field1') }
     
      Field2: ${ template2.safe_value('field2') }
      
      Field3: ${ template2.safe_value('field3') }
      
      Field 4:
      
      % for fruit in template2.safe_value('field4'):
      * ${ fruit }
      % endfor
      
      % if i=='final':
      ${ user_signature }
      % else:
      [ Your signature here ]
      % endif
      
---
attachment:
  - name: A *hello world* document
    filename: Hello_World_Document
    variable name: hello_world[i]
    content: |
      Hello, world!
      
      I only appear if you are older than 10
---
generic object: ALDocument
attachment:
  - variable name: x.addendum
    content: |
      # Addendum for ${ x.filename }
      
      % for field in x.overflow():
      ${ field.field_name }: 
      
      % if isinstance(field.overflow_value(), list):
      % for item in field.overflow_value():
      * ${ item }
      % endfor
      % else:
      > ${ field.overflow_value() }
      % endif
      
      % endfor